FROM node:20

# Install basic development tools
RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    curl \
    bash \
    sudo \
    nano \
    vim \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# Create workspace directory
WORKDIR /workspace

# Install Claude Code globally
RUN npm install -g @anthropic-ai/claude-code@latest

# Create startup script for local workspace (no cloning needed)
RUN echo '#!/bin/bash\n\
set -e\n\
\n\
# Get repository path from environment or default\n\
REPO_PATH=${REPO_PATH:-"/project"}\n\
WORKSPACE_DIR="/workspace/project"\n\
\n\
echo "ðŸš€ Starting SandboxBox with Claude Code..."\n\
echo "ðŸ“ Working with local repository: $REPO_PATH"\n\
echo "ðŸŽ¯ Workspace: $WORKSPACE_DIR"\n\
\n\
# Create symbolic link to the mounted repository\n\
if [ -d "$REPO_PATH" ] && [ -d "$REPO_PATH/.git" ]; then\n\
    echo "ðŸ“‚ Creating workspace symlink to local repository..."\n\
    ln -sf "$REPO_PATH" "$WORKSPACE_DIR"\n\
    cd "$WORKSPACE_DIR"\n\
    echo "âœ… Workspace linked successfully!"\n\
    echo "ðŸ“‹ Current status:"\n\
    git status\n\
    echo "ðŸ“ Repository contents:"\n\
    ls -la\n\
    echo ""\n\
    echo "ðŸ”§ Starting Claude Code..."\n\
    echo "ðŸ’¡ Tip: Changes will be saved directly to the local repository"\n\
    echo "ðŸ’¡ Use Ctrl+C to exit Claude Code"\n\
    exec claude\n\
else\n\
    echo "âŒ Error: $REPO_PATH is not a valid git repository"\n\
    echo "Please ensure the path contains a .git directory"\n\
    echo "Contents of $REPO_PATH:"\n\
    ls -la "$REPO_PATH" 2>/dev/null || echo "Directory not accessible"\n\
    exit 1\n\
fi' > /usr/local/bin/start-local-sandbox.sh && \
    chmod +x /usr/local/bin/start-local-sandbox.sh

# Set default command
CMD ["/usr/local/bin/start-local-sandbox.sh"]